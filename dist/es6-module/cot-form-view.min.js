import View from"./view.js";const CotFormView=View.extend({$liveRegion:null,initialize(...e){return this.$liveRegion=$(".js-aria-live.sr-only, .ui-helper-hidden-accessible").first(),View.prototype.initialize.call(this,...e)},formId:null,rootPath:null,sections:null,success(e){return e.preventDefault(),this.removeErrorMessage(),this.trigger("success"),!1},title:null,definition(){const e=_.result(this,"formId"),t=_.result(this,"id");return{id:e||(t?`${t}Form`:null),rootPath:_.result(this,"rootPath"),sections:_.result(this,"sections"),success:e=>this.success(e),title:_.result(this,"title"),useBinding:!0}},$alert:null,$form:null,footer:'<p><button class="btn btn-primary btn-lg">Submit</button></p>',formValidator:null,postRender:null,preRender:null,render({setFocus:e=!1}={}){this.$el.empty();const t=Object.assign({},_.result(this,"definition",{})),s=e=>{if(t.sections){const s=t.sections;for(let t=0,i=s.length;t<i;t++){const i=s[t];if(e("section",i),i.rows){const t=i.rows;for(let s=0,i=t.length;s<i;s++){const i=t[s];if(e("row",i),i.fields){const t=i.fields;for(let s=0,i=t.length;s<i;s++){e("field",t[s])}}else if(i.grid){const t=i.grid;if(e("grid",t),t.fields){const s=t.fields;for(let t=0,i=s.length;t<i;t++){e("gridField",s[t])}}}else if(i.repeatControl){const t=i.repeatControl;if(e("repeatControl",t),t.rows){const s=t.rows;for(let t=0,i=s.length;t<i;t++){const i=s[t];if(e("repeatControlRow",i),i.fields){const t=i.fields;for(let s=0,i=t.length;s<i;s++){e("repeatControlField",t[s])}}}}}}}}}};this.preRender&&this.preRender.call(this,t,this),s(((e,t)=>{switch(e){case"field":case"gridField":case"repeatControlField":for(const e in t)"onclick"!==e&&"preRender"!==e&&"postRender"!==e&&(t[e]=_.result(t,e));if(this.model&&t.bindTo&&t.choices&&this.model.has(t.bindTo)){const e=Array.isArray(this.model.attributes[t.bindTo])?this.model.attributes[t.bindTo]:[this.model.attributes[t.bindTo]],s=t.choices.map((({text:e,value:t})=>t||e));for(let i=e.length-1;i>=0;i--){const r=e[i];-1===s.indexOf(r)&&t.choices.unshift({text:r})}}}t.preRender&&t.preRender.call(this,t,this)}));const i=new CotForm(t);i.render({target:this.$el}),this.model&&i.setModel(this.model),this.$form=$("form",this.$el).first(),this.formValidator=this.$form.data("formValidation"),this.$alert=$('<div role="alert"></div>'),$(".panel:first",this.$form).before(this.$alert),this.$form.append(_.result(this,"footer","")),s(((e,t)=>{t.postRender&&t.postRender.call(this,t,this)})),this.postRender&&this.postRender.call(this,t,this);const r=$("h2",this.$form).attr("tabindex","-1").first();return e&&r.focus(),this},disabledElements:null,disableFields(){return this.$disabledElements=this.$form.find("button, input, select, textarea").filter(":enabled:visible").prop("disabled",!0),this.$liveRegion.html("Form fields are disabled"),this},enableFields(){return this.$disabledElements&&(this.$disabledElements.prop("disabled",!1),this.$disabledElements=null),this.$liveRegion.html("Form fields are enabled"),this},setErrorMessage(e){return setTimeout((()=>{this.formValidator.resetForm(!1)}),0),this.$alert.addClass("alert alert-danger"),this.$alert.html(e),this},removeErrorMessage(){return this.$alert.removeClass("alert alert-danger"),this.$alert.html(""),this}});export default CotFormView;
//# sourceMappingURL=cot-form-view.min.js.map

{"version":3,"file":"cot-form-view.min.js","sources":["cot-form-view.min.js"],"sourcesContent":["\"use strict\";\n\n/* global $ _ CotForm */\n\n/* global View */\nvar CotFormView = View.extend({\n\t$liveRegion: null,\n\tinitialize: function initialize() {\n\t\tvar _View$prototype$initi;\n\n\t\tthis.$liveRegion = $('.js-aria-live.sr-only, .ui-helper-hidden-accessible').first();\n\n\t\tfor (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n\t\t\targs[_key] = arguments[_key];\n\t\t}\n\n\t\treturn (_View$prototype$initi = View.prototype.initialize).call.apply(_View$prototype$initi, [this].concat(args));\n\t},\n\tformId: null,\n\trootPath: null,\n\tsections: null,\n\tsuccess: function success(event) {\n\t\tevent.preventDefault();\n\t\tthis.removeErrorMessage();\n\t\tthis.trigger('success');\n\t\treturn false;\n\t},\n\ttitle: null,\n\tdefinition: function definition() {\n\t\tvar _this = this;\n\n\t\tvar formId = _.result(this, 'formId');\n\n\t\tvar id = _.result(this, 'id');\n\n\t\treturn {\n\t\t\tid: formId ? formId : id ? \"\".concat(id, \"Form\") : null,\n\t\t\trootPath: _.result(this, 'rootPath'),\n\t\t\tsections: _.result(this, 'sections'),\n\t\t\tsuccess: function success(event) {\n\t\t\t\treturn _this.success(event);\n\t\t\t},\n\t\t\ttitle: _.result(this, 'title'),\n\t\t\tuseBinding: true\n\t\t};\n\t},\n\t$alert: null,\n\t$form: null,\n\tfooter: '<p><button class=\"btn btn-primary btn-lg\">Submit</button></p>',\n\tformValidator: null,\n\tpostRender: null,\n\tpreRender: null,\n\trender: function render() {\n\t\tvar _this2 = this;\n\n\t\tvar _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n\t\t\t_ref$setFocus = _ref.setFocus,\n\t\t\tsetFocus = _ref$setFocus === void 0 ? false : _ref$setFocus;\n\n\t\tthis.$el.empty();\n\t\tvar definition = Object.assign({}, _.result(this, 'definition', {}));\n\n\t\tvar loopDefinition = function loopDefinition(callback) {\n\t\t\tif (definition.sections) {\n\t\t\t\tvar sections = definition.sections;\n\n\t\t\t\tfor (var sIndex = 0, sLength = sections.length; sIndex < sLength; sIndex++) {\n\t\t\t\t\tvar section = sections[sIndex];\n\t\t\t\t\tcallback('section', section);\n\n\t\t\t\t\tif (section.rows) {\n\t\t\t\t\t\tvar rows = section.rows;\n\n\t\t\t\t\t\tfor (var rIndex = 0, rLength = rows.length; rIndex < rLength; rIndex++) {\n\t\t\t\t\t\t\tvar row = rows[rIndex];\n\t\t\t\t\t\t\tcallback('row', row); // FIELDS\n\n\t\t\t\t\t\t\tif (row.fields) {\n\t\t\t\t\t\t\t\tvar fields = row.fields;\n\n\t\t\t\t\t\t\t\tfor (var fIndex = 0, fLength = fields.length; fIndex < fLength; fIndex++) {\n\t\t\t\t\t\t\t\t\tvar field = fields[fIndex];\n\t\t\t\t\t\t\t\t\tcallback('field', field);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} // GRID\n\n\n\t\t\t\t\t\t\tif (row.grid) {\n\t\t\t\t\t\t\t\tvar grid = row.grid;\n\t\t\t\t\t\t\t\tcallback('grid', grid);\n\n\t\t\t\t\t\t\t\tif (grid.fields) {\n\t\t\t\t\t\t\t\t\tvar _fields = grid.fields;\n\n\t\t\t\t\t\t\t\t\tfor (var _fIndex = 0, _fLength = _fields.length; _fIndex < _fLength; _fIndex++) {\n\t\t\t\t\t\t\t\t\t\tvar _field = _fields[_fIndex];\n\t\t\t\t\t\t\t\t\t\tcallback('gridField', _field);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t} // REPEAT CONTROL\n\n\n\t\t\t\t\t\t\tif (row.repeatControl) {\n\t\t\t\t\t\t\t\tvar repeatControl = row.repeatControl;\n\t\t\t\t\t\t\t\tcallback('repeatControl', repeatControl);\n\n\t\t\t\t\t\t\t\tif (repeatControl.rows) {\n\t\t\t\t\t\t\t\t\tvar _rows = repeatControl.rows;\n\n\t\t\t\t\t\t\t\t\tfor (var _rIndex = 0, _rLength = _rows.length; _rIndex < _rLength; _rIndex++) {\n\t\t\t\t\t\t\t\t\t\tvar _row = _rows[_rIndex];\n\t\t\t\t\t\t\t\t\t\tcallback('repeatControlRow', _row);\n\n\t\t\t\t\t\t\t\t\t\tif (_row.fields) {\n\t\t\t\t\t\t\t\t\t\t\tvar _fields2 = _row.fields;\n\n\t\t\t\t\t\t\t\t\t\t\tfor (var _fIndex2 = 0, _fLength2 = _fields2.length; _fIndex2 < _fLength2; _fIndex2++) {\n\t\t\t\t\t\t\t\t\t\t\t\tvar _field2 = _fields2[_fIndex2];\n\t\t\t\t\t\t\t\t\t\t\t\tcallback('repeatControlField', _field2);\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tif (this.preRender) {\n\t\t\tthis.preRender.call(this, definition, this);\n\t\t}\n\n\t\tloopDefinition(function(type, definition) {\n\t\t\tswitch (type) {\n\t\t\t\tcase 'field':\n\t\t\t\tcase 'gridField':\n\t\t\t\tcase 'repeatControlField': {\n\t\t\t\t\tfor (var key in definition) {\n\t\t\t\t\t\tif (key !== 'onclick' && key !== 'preRender' && key !== 'postRender') {\n\t\t\t\t\t\t\tdefinition[key] = _.result(definition, key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (_this2.model && definition.bindTo && definition.choices) {\n\t\t\t\t\t\tif (_this2.model.has(definition.bindTo)) {\n\t\t\t\t\t\t\tvar values = Array.isArray(_this2.model.attributes[definition.bindTo]) ? _this2.model.attributes[definition.bindTo] : [_this2.model.attributes[definition.bindTo]];\n\t\t\t\t\t\t\tvar choices = definition.choices.map(function(_ref2) {\n\t\t\t\t\t\t\t\tvar text = _ref2.text,\n\t\t\t\t\t\t\t\t\tvalue = _ref2.value;\n\t\t\t\t\t\t\t\treturn value || text;\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\tfor (var index = values.length - 1; index >= 0; index--) {\n\t\t\t\t\t\t\t\tvar value = values[index];\n\n\t\t\t\t\t\t\t\tif (choices.indexOf(value) === -1) {\n\t\t\t\t\t\t\t\t\tdefinition.choices.unshift({\n\t\t\t\t\t\t\t\t\t\ttext: value\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (definition.preRender) {\n\t\t\t\tdefinition.preRender.call(_this2, definition, _this2);\n\t\t\t}\n\t\t});\n\t\tvar cotForm = new CotForm(definition);\n\t\tcotForm.render({\n\t\t\ttarget: this.$el\n\t\t});\n\n\t\tif (this.model) {\n\t\t\tcotForm.setModel(this.model);\n\t\t}\n\n\t\tthis.$form = $('form', this.$el).first();\n\t\tthis.formValidator = this.$form.data('formValidation');\n\t\tthis.$alert = $('<div role=\"alert\"></div>');\n\t\t$('.panel:first', this.$form).before(this.$alert);\n\t\tthis.$form.append(_.result(this, 'footer', ''));\n\t\tloopDefinition(function(type, definition) {\n\t\t\tif (definition.postRender) {\n\t\t\t\tdefinition.postRender.call(_this2, definition, _this2);\n\t\t\t}\n\t\t});\n\n\t\tif (this.postRender) {\n\t\t\tthis.postRender.call(this, definition, this);\n\t\t}\n\n\t\tvar $title = $('h2', this.$form).attr('tabindex', '-1').first();\n\n\t\tif (setFocus) {\n\t\t\t$title.focus();\n\t\t}\n\n\t\treturn this;\n\t},\n\tdisabledElements: null,\n\tdisableFields: function disableFields() {\n\t\tthis.$disabledElements = this.$form.find('button, input, select, textarea').filter(':enabled:visible').prop('disabled', true);\n\t\tthis.$liveRegion.html('Form fields are disabled');\n\t\treturn this;\n\t},\n\tenableFields: function enableFields() {\n\t\tif (this.$disabledElements) {\n\t\t\tthis.$disabledElements.prop('disabled', false);\n\t\t\tthis.$disabledElements = null;\n\t\t}\n\n\t\tthis.$liveRegion.html('Form fields are enabled');\n\t\treturn this;\n\t},\n\tsetErrorMessage: function setErrorMessage(message) {\n\t\tvar _this3 = this;\n\n\t\t// Dont know why, but this doesn't work unless it's inside a set timeout.\n\t\tsetTimeout(function() {\n\t\t\treturn void _this3.formValidator.resetForm(false);\n\t\t}, 0);\n\t\tthis.$alert.addClass('alert alert-danger');\n\t\tthis.$alert.html(message);\n\t\treturn this;\n\t},\n\tremoveErrorMessage: function removeErrorMessage() {\n\t\tthis.$alert.removeClass('alert alert-danger');\n\t\tthis.$alert.html('');\n\t\treturn this;\n\t}\n});\n/* exported CotFormView */\n"],"names":["CotFormView","View","extend","$liveRegion","initialize","_View$prototype$initi","this","$","first","_len","arguments","length","args","Array","_key","prototype","call","apply","concat","formId","rootPath","sections","success","event","preventDefault","removeErrorMessage","trigger","title","definition","_this","_","result","id","useBinding","$alert","$form","footer","formValidator","postRender","preRender","render","loopDefinition","callback","sIndex","sLength","section","rows","rIndex","rLength","row","fields","fIndex","fLength","grid","_fields","_fIndex","_fLength","repeatControl","_rows","_rIndex","_rLength","_row","_fields2","_fIndex2","_fLength2","_this2","_ref$setFocus","undefined","setFocus","$el","empty","Object","assign","cotForm","type","key","model","bindTo","choices","has","values","isArray","attributes","map","_ref2","text","value","index","indexOf","unshift","CotForm","$title","target","setModel","data","before","append","attr","focus","disabledElements","disableFields","$disabledElements","find","filter","prop","html","enableFields","setErrorMessage","message","_this3","setTimeout","resetForm","addClass","removeClass"],"mappings":"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"}
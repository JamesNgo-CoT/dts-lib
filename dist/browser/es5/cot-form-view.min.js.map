{"version":3,"file":"cot-form-view.min.js","sources":["cot-form-view.min.js"],"sourcesContent":["\"use strict\";\n\n/* global $ _ CotForm */\n\n/* global View */\nvar CotFormView = View.extend({\n  $liveRegion: null,\n  initialize: function initialize() {\n    var _View$prototype$initi;\n\n    this.$liveRegion = $('.js-aria-live.sr-only, .ui-helper-hidden-accessible').first();\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return (_View$prototype$initi = View.prototype.initialize).call.apply(_View$prototype$initi, [this].concat(args));\n  },\n  formId: null,\n  rootPath: null,\n  sections: null,\n  success: function success(event) {\n    event.preventDefault();\n    this.removeErrorMessage();\n    this.trigger('success');\n    return false;\n  },\n  title: null,\n  definition: function definition() {\n    var _this = this;\n\n    var formId = _.result(this, 'formId');\n\n    var id = _.result(this, 'id');\n\n    return {\n      id: formId ? formId : id ? \"\".concat(id, \"Form\") : null,\n      rootPath: _.result(this, 'rootPath'),\n      sections: _.result(this, 'sections'),\n      success: function success(event) {\n        return _this.success(event);\n      },\n      title: _.result(this, 'title'),\n      useBinding: true\n    };\n  },\n  $alert: null,\n  $form: null,\n  footer: '<p><button class=\"btn btn-primary btn-lg\">Submit</button></p>',\n  formValidator: null,\n  postRender: null,\n  preRender: null,\n  render: function render() {\n    var _this2 = this;\n\n    var _ref = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref$setFocus = _ref.setFocus,\n        setFocus = _ref$setFocus === void 0 ? false : _ref$setFocus;\n\n    this.$el.empty();\n    var definition = Object.assign({}, _.result(this, 'definition', {}));\n\n    var loopDefinition = function loopDefinition(callback) {\n      if (definition.sections) {\n        var sections = definition.sections;\n\n        for (var sIndex = 0, sLength = sections.length; sIndex < sLength; sIndex++) {\n          var section = sections[sIndex];\n          callback('section', section);\n\n          if (section.rows) {\n            var rows = section.rows;\n\n            for (var rIndex = 0, rLength = rows.length; rIndex < rLength; rIndex++) {\n              var row = rows[rIndex];\n              callback('row', row); // FIELDS\n\n              if (row.fields) {\n                var fields = row.fields;\n\n                for (var fIndex = 0, fLength = fields.length; fIndex < fLength; fIndex++) {\n                  var field = fields[fIndex];\n                  callback('field', field);\n                }\n\n                continue;\n              } // GRID\n\n\n              if (row.grid) {\n                var grid = row.grid;\n                callback('grid', grid);\n\n                if (grid.fields) {\n                  var _fields = grid.fields;\n\n                  for (var _fIndex = 0, _fLength = _fields.length; _fIndex < _fLength; _fIndex++) {\n                    var _field = _fields[_fIndex];\n                    callback('gridField', _field);\n                  }\n                }\n\n                continue;\n              } // REPEAT CONTROL\n\n\n              if (row.repeatControl) {\n                var repeatControl = row.repeatControl;\n                callback('repeatControl', repeatControl);\n\n                if (repeatControl.rows) {\n                  var _rows = repeatControl.rows;\n\n                  for (var _rIndex = 0, _rLength = _rows.length; _rIndex < _rLength; _rIndex++) {\n                    var _row = _rows[_rIndex];\n                    callback('repeatControlRow', _row);\n\n                    if (_row.fields) {\n                      var _fields2 = _row.fields;\n\n                      for (var _fIndex2 = 0, _fLength2 = _fields2.length; _fIndex2 < _fLength2; _fIndex2++) {\n                        var _field2 = _fields2[_fIndex2];\n                        callback('repeatControlField', _field2);\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    };\n\n    if (this.preRender) {\n      this.preRender.call(this, definition, this);\n    }\n\n    loopDefinition(function (type, definition) {\n      switch (type) {\n        case 'field':\n        case 'gridField':\n        case 'repeatControlField':\n          {\n            for (var key in definition) {\n              if (key !== 'onclick' && key !== 'preRender' && key !== 'postRender') {\n                definition[key] = _.result(definition, key);\n              }\n            }\n\n            if (_this2.model && definition.bindTo && definition.choices) {\n              if (_this2.model.has(definition.bindTo)) {\n                var values = Array.isArray(_this2.model.attributes[definition.bindTo]) ? _this2.model.attributes[definition.bindTo] : [_this2.model.attributes[definition.bindTo]];\n                var choices = definition.choices.map(function (_ref2) {\n                  var text = _ref2.text,\n                      value = _ref2.value;\n                  return value || text;\n                });\n\n                for (var index = values.length - 1; index >= 0; index--) {\n                  var value = values[index];\n\n                  if (choices.indexOf(value) === -1) {\n                    definition.choices.unshift({\n                      text: value\n                    });\n                  }\n                }\n              }\n            }\n\n            break;\n          }\n      }\n\n      if (definition.preRender) {\n        definition.preRender.call(_this2, definition, _this2);\n      }\n    });\n    var cotForm = new CotForm(definition);\n    cotForm.render({\n      target: this.$el\n    });\n\n    if (this.model) {\n      cotForm.setModel(this.model);\n    }\n\n    this.$form = $('form', this.$el).first();\n    this.formValidator = this.$form.data('formValidation');\n    this.$alert = $('<div role=\"alert\"></div>');\n    $('.panel:first', this.$form).before(this.$alert);\n    this.$form.append(_.result(this, 'footer', ''));\n    loopDefinition(function (type, definition) {\n      if (definition.postRender) {\n        definition.postRender.call(_this2, definition, _this2);\n      }\n    });\n\n    if (this.postRender) {\n      this.postRender.call(this, definition, this);\n    }\n\n    var $title = $('h2', this.$form).attr('tabindex', '-1').first();\n\n    if (setFocus) {\n      $title.focus();\n    }\n\n    return this;\n  },\n  disabledElements: null,\n  disableFields: function disableFields() {\n    this.$disabledElements = this.$form.find('button, input, select, textarea').filter(':enabled:visible').prop('disabled', true);\n    this.$liveRegion.html('Form fields are disabled');\n    return this;\n  },\n  enableFields: function enableFields() {\n    if (this.$disabledElements) {\n      this.$disabledElements.prop('disabled', false);\n      this.$disabledElements = null;\n    }\n\n    this.$liveRegion.html('Form fields are enabled');\n    return this;\n  },\n  setErrorMessage: function setErrorMessage(message) {\n    var _this3 = this;\n\n    // Dont know why, but this doesn't work unless it's inside a set timeout.\n    setTimeout(function () {\n      return void _this3.formValidator.resetForm(false);\n    }, 0);\n    this.$alert.addClass('alert alert-danger');\n    this.$alert.html(message);\n    return this;\n  },\n  removeErrorMessage: function removeErrorMessage() {\n    this.$alert.removeClass('alert alert-danger');\n    this.$alert.html('');\n    return this;\n  }\n});\n/* exported CotFormView */"],"names":["CotFormView","View","extend","$liveRegion","initialize","_View$prototype$initi","this","$","first","_len","arguments","length","args","Array","_key","prototype","call","apply","concat","formId","rootPath","sections","success","event","preventDefault","removeErrorMessage","trigger","title","definition","_this","_","result","id","useBinding","$alert","$form","footer","formValidator","postRender","preRender","render","loopDefinition","callback","sIndex","sLength","section","rows","rIndex","rLength","row","fields","fIndex","fLength","grid","_fields","_fIndex","_fLength","repeatControl","_rows","_rIndex","_rLength","_row","_fields2","_fIndex2","_fLength2","_this2","_ref$setFocus","undefined","setFocus","$el","empty","Object","assign","cotForm","type","key","model","bindTo","choices","has","values","isArray","attributes","map","_ref2","text","value","index","indexOf","unshift","CotForm","$title","target","setModel","data","before","append","attr","focus","disabledElements","disableFields","$disabledElements","find","filter","prop","html","enableFields","setErrorMessage","message","_this3","setTimeout","resetForm","addClass","removeClass"],"mappings":"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"}
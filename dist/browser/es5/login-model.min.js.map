{"version":3,"file":"login-model.min.js","sources":["login-model.min.js"],"sourcesContent":["\"use strict\";\n\n/* global Model */\nvar LoginModel = Model.extend({\n  defaults: {\n    app: 'cot-app'\n  },\n  idAttribute: 'sid',\n  parse: function parse(response, options) {\n    this.clear();\n    return Model.prototype.parse.call(this, response, options);\n  },\n  login: function login() {\n    var _this = this;\n\n    if (!this.isNew()) {\n      return this.verify();\n    }\n\n    return new Promise(function (resolve, reject) {\n      _this.save(null, {\n        headers: {\n          'Accept': 'application/json; charset=utf-8',\n          'Content-Type': 'application/json; charset=utf-8'\n        }\n      }).then(function (data) {\n        _this.setLastVerified(new Date());\n\n        resolve(data);\n      }, function (jqXHR, textStatus, errorThrown) {\n        reject(errorThrown);\n      });\n    });\n  },\n  logout: function logout() {\n    var _this2 = this;\n\n    if (this.isNew()) {\n      return Promise.resolve();\n    }\n\n    return new Promise(function (resolve) {\n      _this2.destroy({\n        headers: {\n          'Authorization': _this2.attributes.userID\n        }\n      }).then(function () {\n        _this2.reset();\n\n        _this2.setLastVerified(null);\n\n        resolve();\n      }, function () {\n        resolve();\n      });\n    });\n  },\n  verify: function verify() {\n    var _this3 = this;\n\n    if (this.isNew()) {\n      return Promise.reject();\n    }\n\n    return new Promise(function (resolve, reject) {\n      _this3.fetch({\n        headers: {\n          'Accept': 'application/json; charset=utf-8',\n          'Content-Type': 'application/json; charset=utf-8'\n        }\n      }).then(function (data) {\n        _this3.setLastVerified(new Date());\n\n        resolve(data);\n      }, function (jqXHR, textStatus, errorThrown) {\n        return _this3.logout().then(function () {\n          reject(errorThrown);\n        });\n      });\n    });\n  },\n  lastVerified: null,\n  preTimeout: null,\n  preTimeoutDelay: 1770000,\n  // (30 * 60 * 1000) - (10 * 1000) = 1770000\n  timeout: null,\n  timeoutDelay: 1800000,\n  // 30 * 60 * 1000 = 1800000\n  setLastVerified: function setLastVerified(date) {\n    var _this4 = this;\n\n    if (this.preTimeout) {\n      clearTimeout(this.preTimeout);\n      this.preTimeout = null;\n    }\n\n    if (this.timeout) {\n      clearTimeout(this.timeout);\n      this.timeout = null;\n    }\n\n    if (date) {\n      this.lastVerified = date;\n      this.preTimeout = setTimeout(function () {\n        return void _this4.trigger('pretimeout');\n      }, this.preTimeoutDelay);\n      this.timeout = setTimeout(function () {\n        return void _this4.trigger('timeout');\n      }, this.timeoutDelay);\n    } else {\n      this.lastVerified = null;\n    }\n  }\n});\n/* exported LoginModel */"],"names":["LoginModel","Model","extend","defaults","app","idAttribute","parse","response","options","this","clear","prototype","call","login","_this","isNew","Promise","resolve","reject","save","headers","Accept","Content-Type","then","data","setLastVerified","Date","jqXHR","textStatus","errorThrown","verify","logout","_this2","destroy","Authorization","attributes","userID","reset","_this3","fetch","lastVerified","preTimeout","preTimeoutDelay","timeout","timeoutDelay","date","_this4","clearTimeout","setTimeout","trigger"],"mappings":"aAGA,IAAIA,WAAaC,MAAMC,OAAO,CAC5BC,SAAU,CACRC,IAAK,WAEPC,YAAa,MACbC,MAAO,SAAeC,EAAUC,GAE9B,OADAC,KAAKC,QACET,MAAMU,UAAUL,MAAMM,KAAKH,KAAMF,EAAUC,IAEpDK,MAAO,WACL,IAAIC,EAAQL,KAEZ,OAAKA,KAAKM,QAIH,IAAIC,QAAQ,SAAUC,EAASC,GACpCJ,EAAMK,KAAK,KAAM,CACfC,QAAS,CACPC,OAAU,kCACVC,eAAgB,qCAEjBC,KAAK,SAAUC,GAChBV,EAAMW,gBAAgB,IAAIC,MAE1BT,EAAQO,IACP,SAAUG,EAAOC,EAAYC,GAC9BX,EAAOW,OAdFpB,KAAKqB,UAkBhBC,OAAQ,WACN,IAAIC,EAASvB,KAEb,OAAIA,KAAKM,QACAC,QAAQC,UAGV,IAAID,QAAQ,SAAUC,GAC3Be,EAAOC,QAAQ,CACbb,QAAS,CACPc,cAAiBF,EAAOG,WAAWC,UAEpCb,KAAK,WACNS,EAAOK,QAEPL,EAAOP,gBAAgB,MAEvBR,KACC,WACDA,SAINa,OAAQ,WACN,IAAIQ,EAAS7B,KAEb,OAAIA,KAAKM,QACAC,QAAQE,SAGV,IAAIF,QAAQ,SAAUC,EAASC,GACpCoB,EAAOC,MAAM,CACXnB,QAAS,CACPC,OAAU,kCACVC,eAAgB,qCAEjBC,KAAK,SAAUC,GAChBc,EAAOb,gBAAgB,IAAIC,MAE3BT,EAAQO,IACP,SAAUG,EAAOC,EAAYC,GAC9B,OAAOS,EAAOP,SAASR,KAAK,WAC1BL,EAAOW,UAKfW,aAAc,KACdC,WAAY,KACZC,gBAAiB,MAEjBC,QAAS,KACTC,aAAc,KAEdnB,gBAAiB,SAAyBoB,GACxC,IAAIC,EAASrC,KAETA,KAAKgC,aACPM,aAAatC,KAAKgC,YAClBhC,KAAKgC,WAAa,MAGhBhC,KAAKkC,UACPI,aAAatC,KAAKkC,SAClBlC,KAAKkC,QAAU,MAGbE,GACFpC,KAAK+B,aAAeK,EACpBpC,KAAKgC,WAAaO,WAAW,WACfF,EAAOG,QAAQ,eAC1BxC,KAAKiC,iBACRjC,KAAKkC,QAAUK,WAAW,WACZF,EAAOG,QAAQ,YAC1BxC,KAAKmC,eAERnC,KAAK+B,aAAe"}